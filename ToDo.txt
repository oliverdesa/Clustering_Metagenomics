Finishing up the break, What I need to do this week

04/01/2024

- Put together and create a small presentation of the protein purification to show dana
- Write down some points of potential next steps
- take inventory of all the trial patients 
	- How many do I have completed?
	- find names of those missing, check if filt reads exist, if not re-download from scratch
- Finish the metadata sheet 
- Test applying the clustering, take notes and important info.
	- How many clusters are being made? How many idividual protein do each of these clusters contain?
- download and run the bariatric data, might have to check how many of the files are potentially missing

05/01/2024

- queued up the remaining reads for kneaddata (Done, Failed)
- clustered PRJEB7774 and applied maaslin
	- 1 significant cluster when doing raw maaslin on relab data
	- ~9 sig clusters when doing CLR maaslin on relab data
	- raw maaslin might be taking into account the actual abundaces better, hard to tell
	- CLR normalization has very low N not 0, looks like a bug with maaslin but not sure. 
- Make a process to look deeper into differentially abundant clusters;
	- what taxa are they mostly coming from?
	- what domains/sec tags do proteins in that cluster typically have? (Running now)
	- visualize the cluster changes between patients
	- make function to easily pull initial proteins collected under a cluster (Done)
	
- Cluster and run Maaslin2 on PRJEB10878
	- Look for repeatedly downregulated clusters

08/02/2024

- Combined and ran DA on Large CRC dataset
- in the pooled, CLR normalized analysis, LD-carboxys are downregulated in early stage patients (p=0.0305281909265825, q=0.24422552741266) (Not that important)
- In analysis, stage 1/2 are characterized as early stage, 3/4 are late stage. HS and MP seperate from healthy, might have to combine those into simply cancer vs no cancer
- signalp and IPS are finished and downloaded to OneDrive, need to make some functions.
	- How do Secreted DLEs change?
	- What are the domains/secretion tags of the clusters? (do it for all to make it easier)

09/01/2024

- Start by building function to grab number of DLE per cluster, domains + secretion tag calculations/cluster make a csv to easily map and build figures
- test out random forest stuff
- issues with cluster mapping, only 1879 of 1960 original proteins seem to be mapping all the way to foldseek clusters. 
- Created function to pull the amount of protiens stored within each cluster
- crreated a function to annotation secretion tags based on uniref ID
- Could technically do DA testing on secreted only DLEs. 
- Should apply DA testing with clustering on PRJEB10878

10/01/2024

- Tried to do DA testing on PRJEB10878 but metadata was lost on old ssd. Metadata download doesnt seem to include patient conditions
- Re-assess clustering function for secretion annotation and protein counts
- SOLVED, some proteins do not have their 3d structured annotated yet so are ignored in the foldseek clustering process. Most are singletons and havent been seen in any of the shotgun data yet. Can submit a job to get those 3d structures predicted for completion sake. 

11/01/2024

- Today, prepare some figures for meeting with Dana and meeting with charlie.
- Make a pooled DA testing figure to compare with the clustered data. (DONE)
- Train some models on the pooled and clustering data then print out some figures. (Move this to later)
- Display some info on cluster secretion tags, domains if possible. 
- make figures of PRJEB7774 and look for common clusters. (Fig made, look for common clusters)
- Plan to make comparisons;
	- pull tables from 8156 and 7774 from heatmap script, pull common clusters that are downregulated. (IPR)
	- use that to look at secretion, % secreted per cluster. (DONE)

13/01/2024

- Notes from meeting with Charlie:
	- find custom database from genomes that map back to uniref IDS. Use those to determine taxanomic composition of clusters.
	- might have multiple mapping back to the same taxa, need to pick one
	- Adjust colour gradient of heatmap so that white is at 0 (done)
	- build a correlation plot between the 2 datasets to see how related they are (Done, weak correlation)
	- look deeper into the formula log(qvalue) * sign(coeff)
	- maybe plot effect size (just coeff?)
	- PCA the clusters from the dataset to see if theyre different
	- Need to prove taxa shifts are not all that explain cluster diffs
- Still need to find PRJEB10878 metadata (Found)
- What clusters are downregulated the most? Of these clusters, which have the highest correlation between the 2 datasets?

15/01/2024

- Ran DA testing on PRJEB10878
	- No significantly down-regulated clusters unfortunately
	- the most common cluster A0A1C5VJV2 Is still heavily downregulated in this dataset
	- This cluster has only 2 members unfortunately, A0A1C5VJV2 and A0A1V6EIC9
	- Bost seem to be coming from clostrideacea family. Should check species from our databases and see what we have.
- Will now start pulling taxa for each uniref ID in our database and add it to the cluster_info.csv.
	- Difficulty finding blastped genomes, wait for charlie
- Will now take a look at GVHD data
	- Really not many samples, probably not worth looking at at this point, wait for large danish dataset
- species question cant be answered until I get the blastp results.
- Should continue with the domain information tomorrow, create the csv
- should also implement code to log and pull secretion information from individual proteins captured, not just cluster members
- relative abundance of each protein also matters in this case, might be a bit complicated.
- Proteins without 3D structure:

17/01/2024

- Clustered all groups of enzymes through msmeqs
- downloaded all PDBs of cluster reps
- ran foldseek to get foldseek clusters
- working on developing a function to create cluster mapping tools
- mapping through DF instead of dict
- important 3D structures may be missing
- Scanning through the cluster maps, quite a few of the mmmseqs representatives are missing AF PDBs. Some ways to address:
	1. Create the PDBs. Set up alphafold on the cluster and feed in un-predicted seqs for prediction. Time consuming, not sure if possible.
	2. Ignore those without PDBs. Those lacking structures are probably rarely known or unimportant protein. Could add checks in the clustering code to 
	   report how many uniref IDs from the humann output table are unnaccounted for after clustering. Potential to miss important proteins.
	3. Could look for predicted proteins clustered to un-predicted rep sequences to replace the representative for that cluster. Might be a slightly poorer
	   representation of all the proteins within that cluster, however would have less gaps, likely would be better than completely ignoring
- Should likely start with 2 and then go from there depending on results. 
- make sure kneaddata + trimmomatic are working, start the bariatric data on graham
	- remember to adjust the kneaddata script for the the 4 in the reads. 

18/01/2024

- started bariatric data and last of CRC data on graham
	- same error with CRC data, the reads are misaligned
- Created an improved large clustering function to look at all of the enzymes within the humann table
- A significant amount of the enzymes are remaining unclustered because the mmseqs reps dont have 3D structures
329 DL-endopeptidase found, 14 DL-endopeptidase unclustered
3935 LD-carboxypeptidase found, 2225 LD-carboxypeptidase unclustered
31 LD-endopeptidase found, 31 LD-endopeptidase unclustered
11481 DD-carboxypeptidase found, 6677 DD-carboxypeptidase unclustered
0 Diadenylate-cyclase found, 0 Diadenylate-cyclase unclustered
- ** amidases, glucosaminidases and muramidases omitted for speed
- email was sent to scinet, hopefully will get a response soon regarding running alphafold
- in the meantime will likely need to move forward with option 3.

22/01/2024

- Scinet responded, beluga and graham are capable of runnning alphafold. Look into setting that up.
- Last of CRC data has error, something went wrong with bariatric. Go back and look.
- addressed errors other than trimmomatic, ran jobs again.
- Need to write a function to check if a Uref ID has a PDB, if print it to a txt to later feed into AF
- Set up Globus, error connecting to clusters, emailed support. 
	- Should try to set up AF asap because it will take ~ a day to install
- Regarding the previous note about the function; What to do:
	- First drop singletons: print out info after
	- Second, create a dataframe without any of the fully clustered protiens
	- Third, loop through and check for PDBs from full Uref100s, if it has one, replace the mmseqs rep w that protein.
	- print out some stats on how many are now unclustered
	- re-run foldseek.
	
23/01/2024

- AF dependancies set up on Beluga, need to figure out downloading the databases, especially with globus if possible (downloading)
- Check on bariatric/CRC data (bariatric good, mismatched reads in CRC)
- subbed humann on bariatric, subbed kneaddata on resequenced reads
- continue with clustering

24/01/2024

- AF databases are being downloaded, might be ready by tomorrow
- bariatric has humann running
- clustering updates:
	- Wrote code to identify singletons, decided to use it after the re-clustering
	- wrote code to pull no PDB repseqs and list their clustered uref IDs, working on a way to check for PDB and download that 
	- code finished; pulls unclustered mmseqs clusters, searches clustered UrefIds for complete PDBs, makes that the new rep, otherwise nothing
	- returns a new csv with the replaced reps, automatically downloads all of the new PDBs and puts out a sheet of which PDBs need to be removed
	- wrote a shell script that reads the to_delete.txt and automatically deletes all files with those IDs from dir, can then copy new PDBs in
	- function takes long to run prob ~3h, but likely only needs to run once.

25/01/2024

- Cluster tables made, new PDBs downloaded and to_delete files creates
- Need to now sub in these new PDBs and re-run foldseek
- After this, remove the singletons. 
- Put together some discussion topics for Dana
- new PDBs have been subbed in, will start running foldseek
- Topics to talk about with Dana:
	1. briefly show GVHD Nod2 stimulation results talk about pitfalls, next experiment
		- will check all PRRs we have to see fi there is more motive to investigate Nod2
	2. bariatric data: processing done for the most part, need to talk to yasaman about metadata
	3. Clustering: wanted to adress the machine learning problem we mentioned, would need to cluster all enzymes first.
		- clustered all enzymes, realized quite a few of them were not getting clustered into their final foldseek clusters
		- 2 ways to address it, one method worked, talk about that.
		- will be finished tonight, then will re-run on all datasets for DLEs along with all proteins
		- will re-train models with clustered data and predict again
		- species data; DLE blastp was lost on the cluster because it wasnt used recently enough
		- re-running it again for DLEs, will also do ld_carboxys and dd_carboxys
		- finished secretion and domain tables to get extra info
	4. Ask for updates on GVHD data
		- not worth applying clustering to current GVHD, not large enough
	5. iHMP2 data, will work on this, have to pick a subset of the data because lots of patients and we have to process from scratch
	6. Sting cells are taking very long to grow, check on them before meeting. have 23cgamp ready, still need to get digitonin.
	7. Ask about future questions, potentially more grad school...
- Finished clustering by foldseek. Now need to tkae the remade cluster maps, drop the foldseek column and replacements, then remap the enw foldseek clusters to the mseqs cluster

26/01/2024

- New foldseek clusters and maps to be edited are present on the external drive
- combined bariatric reads are finished kneaddata, start humann (started)
- Load signalp and IPS onto niagara and graham for charlie

29/01/2024

- Sent an email to yasaman asking for the bariatric metadata
- uploaded scripts to niagara but have issues uploading signalp. Not sure what the issues is
- Continue on creating new cluster maps now
- New cluster maps now created, significant improvement on cluster mapping
- Is it necessary to drop singletons? Could help eliminate changes a result of just a single species changing. 
	- Could also lose sinsitivity to important enzymes. Unlikely a random protein would be that important?
	- They did this in their paper so have justification.
- pause for now and look at ICI data.
- Dropping singletons now; here are the changes:
Original DataFrame shape for dl_endopeptidase: (1965, 4)
Modified DataFrame shape for dl_endopeptidase: (1896, 4)
Original DataFrame shape for ld_carboxypeptidase: (41419, 4)
Modified DataFrame shape for ld_carboxypeptidase: (41278, 4)
Original DataFrame shape for ld_endopeptidase: (13862, 4)
Modified DataFrame shape for ld_endopeptidase: (13862, 4)
Original DataFrame shape for amidase: (180887, 4)
Modified DataFrame shape for amidase: (179497, 4)
Original DataFrame shape for dd_carboxypeptidase: (125228, 4)
Modified DataFrame shape for dd_carboxypeptidase: (124658, 4)
Original DataFrame shape for diadenylate_cyclase: (24627, 4)
Modified DataFrame shape for diadenylate_cyclase: (24587, 4)
Original DataFrame shape for muramidase: (331610, 4)
Modified DataFrame shape for muramidase: (329723, 4)
Original DataFrame shape for glucosaminidase: (13210, 4)
Modified DataFrame shape for glucosaminidase: (12979, 4)

- clustered the DRA008156 data, setting up the machine learning ipynb to do testing

30/01/2024
- Continuing the machine learning, after can re-do DA testing on new clusters.

04/02/2024
- Schedule for Monday
- Morning: LOI for LMP, Review CV pay fee, remind Steph and Bryan
- Look at ICI data
- Lunch
- In lab; split cells, get digitonin, order CDN ELISAs
- plan sting experiment for Wed, talk to nayanan about his samples
- try to analyze ICI data. 
- research PhD

05/02/2024
- Completed LOI, Reviewed CV and payed fee.
- Need to write draft for steph and send reminders
- found and downloaded metadata for 2 ICI trials
- split cells, planned exp, ordered ELISAs
- Bariatric data and 2 ICI trials are now ready for DA testing.

06/02/2024
- Do DA testing on ICI and bariatric trials, plot heatmaps and total DA figures.
- No significant associations in second ICI trial, first trial has wrong metadata.
- From bariatric:
	- 262 6M missing from processed data, present on cluster
	- 
	
09/02/2024
- Have done clustering and visualization from bariatric data, Will need to figure out applying maaslin, especiallyh with the use of paired samples.
	- remember you have to assign temporal markers to the timepoint as seen in the thread. 
- look at CRC data, make sure clustering is complete for all 3 trials, do some analysis on consistently downregulated clusters. 

12/02/2024
- Troubleshoot bariatric maaslin
- Still having trouble with maaslin, trying to set up MicrobiomeStat, confusing with feature.ann
- submitted blastp for DLEs again, will do LD_carboxys next
- checked the graham to delete, should be fine. 
- blastp failed, restarted with changes
- will try simpler test for grouped bariatric data. Might have to explore maasline and microbiomestat if doing clustering data.
- Friedmann test + Conover post hoc completed on DLEs and LDCs. DLEs significantly downregulated post-surgery, LDCs sig upregulated post-surgery.
- blastp now working 

13/02/2024

- sent charlie copies of bariatric data to try maaslin
- blastp seems to have finished, will have to verify outputs
- depending on the results of that, move forward with the CRC data
- blastp was only annotating half of the families due to issue with memebers text file. Fixed and restarted.

22/02/2024

- In Florida
- Troubleshooting extract blastp script
- cleaning beluga bc reaching file limit
- need to blast sting producing enzymes

26/02/2024

- First monday back
- need to confirm but looks like extract blastp finally finished.
- after confirming need to run signalp, pull species and map these data to clusters
- create informative information for the clusters from this data + domains
- Should be getting new ICI metadata today, check on the reads and begin processing them
- reads being downloaded, kneaddata queued for the new ici data.
- cant make cdnb database, disk usage apparently full but that doesnt seem to be the case, might just need some time.
- Now will work on getting data from the extract blastp
- zipping data to move onto external drive. Will use mapping file to pull species. assign those species to protein hits in the clusters.
- need to run IPS and signalp on these hits to develop those databases.

27/02/2024

- finished signalp, IPS running, almost finished creating uniref/genome mapping file
- Created map with data on secretion + taxa. Need to add uniref + domain info to complete
- once finished can get info on all of the important clusters and make infographics on their domain/secretion/taxa etc. 
- might be good to also do muscle on clusters to look for similarity.

28/02/2024

- Now have signalp, taxa, uniref ID maps. IPS still runnning for domain info.
- got metadata for nice ici dataset, reads are being processed by kneaddata currently, could begin humann to save time.
- got baseline reads for that dataset, began downloading them on graham. will need to do some work on the multiple metadata files to get all the information from this set. 
- submitted cdnb for blastp
- ips ran out of time, need to either restart with more time or edit file to pickup where left off.
- created a table with the uniref ID, genome IDs, taxa info and secretion info. 
- began writing a function to quickly pull information about a cluster when given the cluster ID. 
	- Need to validate whether the extract blastp worked correctly, seems like there are potentially too many hits
	- Need to figure out what to do with strain variants of the same species.. average data maybe?

29/02/2024

- conitnued downloading ici reads, kneaddata still running, humann still queued.
- check on IPS
- restarted IPS with small change, restarted cdnb blastp with another small fix
- now going back to mapping work
- Fixed the code to map the hits correctly with taxa information
- now updating function to correctly pull species+secretion info

03/03/3034

- check on ici reads
- check on IPS
- fixed graham for the ici trials, kneaddata queued for all of the remaining reads, set to 5 days
- sub_humann submitted on the first subset of the data, the cdnb db was added so that it gets annotated in the humann reads.
- interproscan looks finished, data downloaded onto the ssd, will map today
- added the IPS data to the info table. 
- functionalities to add and pull from cluster info data:
	- how many individual species/cluster
	- % secreted from the cluster
	- IPS domains present in the cluster as % of proteins
- Added functionality to plot secretion info plus domain info.
- Might need to adjust how I'm displaying the domain information

06/03/2024

- re-formatting and configuring the cluster information code to make it into a script to be ran from the terminal
- cluster information function is essentially complete what do do moving forward:
	- what is unique about these clusters?
		- are they secreted more often than other clusters?
		- Do they have unique domains/certain domains more abundantly than other clusters?
		- How could I look into the sequences of these clusters and find characteristics that make them distinct?
		- what families/genera typically encode DLEs found in these clusters?
		- what families/genera typically encode DLEs found in less important clusters?
		- potentially look at a new dataset with only these important clusters, see if we can get significance. 
- while on average the downregulated clusters have a much higher proportion of secretion compared to the others, there is too much variation to find any significance. 

07/03/2024

- some jobs ran, some failed, check up and manage the cluster first
- On Graham; kneaddata on PRJEB4 failed, re-ran using kneaddata custom. the other kenaddata and human are running fine.
- issues with blasting/extracting cdnb for some reason. Luckily its still running in the ici humann rn. Will try and figure it out.
- should potentially run metaphlan on this new ici trial as well to validate cluster changes.
- re-ran blastp for cdnb, will re-run extract script after finished with a changed log file location.
- continue working on the python terminal package
- what should the package take as arguments:
	- the first argument should be a cluster id, or a .txt file with multiple cluster ids.

11/03/2024

- check on clusters
- graham ran out of file space, re-organized and ran kenaddata and humann
- ran extract blastp
- extract blastp finished

12/03/2024

- extract blastp failed again, re-ran with new path.
- 1 kneaddata running, other 2 jobs queued

13/03/2024

- kneaddata and humann running on the ici trial data now
- extract blastp finished again
- seems to have finally worked on the cdnb genes

14/03/2024

- kneaddata finished on PRJEB7
- kneaddata still running on PRJEB4
- humann running on both
- extract blastp on cdnbs worked to create a log file but didnt actually extract the fastas. Can use the log file to get them myself

15/03/2024

- check up on clusters again
- continue with cluster/crc work, figure out what else I might be able to do
- a cluster may have multiple uniref IDs within that cluster but if only 1 maps to the genomes it will show as only those hits. Should I incorporate those proteins for domain/secretion information? wouldnt have any taxanomic information

18/03/2024

- re-organized and ran kneaddata/humann for the ici datasets.
- work on TFRI meeting slides

19/03/2023

- re-ran all cluster processes, need to free up space on graham
- created domain network figure, began code for phylogenetic tree

20/03/2024

- chekcing on cluster making sure everything is moving

01/04/2024

- ici trial only finished check on cluster.
- too many issues on graham, all scripts and tools are being loaded onto beluga
- while waiting take a look back on the presentation, make sure to note questions for dana.
ERR12356794
ERR12356819

10/04/2024

- a lot of progress made recently with visualizations/new insights into clusters.
- Will be more consistent updating this ToDo/changelog
- As of now:
	- there are some reads left of the ICI tral that need to be kneaded. The kneaddata script broke with the updating of the standard enviornment. Will reach out to the team to get a bit of help with moving packages over. humann almost finished otherwise
	- In this ICI trial need to correlate the results with their processed metaphlan data. 
	- Need to analyze samples from UC cohorts and look for similarities in cluster shifts
	- Need to get dana to write a draft to the authors of the multi-omics paper to have access to that dataset. 
	- working on getting beluga set up to process samples alongisde graham

11/04/2024

- fixed kneaddata script, PRJEB4 samples will be finished with this iteration, will likely need to run the PRJEB7 script once more with ~12 hours of time to finish off those samples, should immediately finish off the humann annotations and can begin clustering/DA testing.
- Dana has sent an email to the multi-omics people. 
- Bryan suggested a volcano plot to show that the DLE clusters are most consistently downregulated in CRC patients compared to healthy controls. Also showed interest in adenoma data, might be worth splitting the large dataset by adenomas too to look there for shifts.
- Need to improve the stacked barchart figure, or improve the pie chart figures. 
- Should do some further work on machine learning stuff.
	- Train on solely DLEs, otherwise why would we focus on them? In contrast maybe look at clusteral analysis for all the enzymes, define these clusters and how they relate? Might be way too much data. 
- lets start looking at UC data, want to keep clusters moving at all times ideally, maybe get it set up on beluga.
- keep learning paralellization (oof), could pay off with time saved. 

16/04/2024

- Essentially all of the ICI samples are done, issue with one of them. 
- The metadata seems to have plenty of patients without matching samples, need to verfy I did it properly and then potentially reach out to the author to make sure. (Done)
- After this I will work on developing volcano plots for changes in the DLEs from CRC patients. (Done)
- Then work to develop a proper schematic for clustering on biorender
- the volcano plot was developed for the CRC clusters. Important issue with Effect sizes that needs to be considered, shoul dprobably be brought up with John Parkinson in the meeting.
- Created a heatmap that combines all three trials on the sample plot for easier visualization.
- Might want to plot grouped data but only DLEs, then lead into the heatmaps do better visualize the clustering pathway
- Need to develop the schematic soon, running out of time today.

17/04/2024

- Did not get a response from the author yet, might need to move forward with the analysis as best I can
- Remind steph to send in reference letterr, Mogen LOI is almost complete
- make Schematic for clustering
- make grouped figure for DLEs only across 3 trials
- combining abudnance tables is a huge pain rn. Good opportunity to brush up on pandas

18/04/2024

What do I need to do today?
- Schematic
- pooling function to visualize abundance data
- fix taxonomic visualization function
- put together the lost run from the ici data and maybe begin analysis. 

- abundances figure is finally finished. Need to just make minor adjustment for cropping in the code and potentially chnage colours to fit the theme of the presentation
- Lets start piecing together the ICI data as much as possible
- finished abundance figure. 
- might be useful to make a figure showing effect size changes between individual taxa and then summed into a cluster to help explain low effect sized.

- Joined table offloaded to laptop
- cannot write to ssd due to format of the drive. Need to zip all contents on windows pc, re-format drive and then unzip back in.

stats that would be interesting from the ICI data:
	How to total abundances change with time?
	Are certain clusters associated with positive response?
	How are clusters associated with colitis?
	How do antibiotics effect cluster shifts?

19/04/2024

- timesheet first (done)
- Cleaned metadata, joined tables, clustered table.

02/05/2024

- Back log of comments that were not put here:
Notes for Today:
- Let's start with ICI data. Merged tables are created, lets work with the metadata and pull some stats from it
- clustering the outputs now. 9/397 DLEs were unclusterd. These should be put into their own columns or have a 
seperate dataframe made to analyze changes in these individual genes, see if theyre significant and then map to taxa
- began maaslin analysis, nothing so far with colitis associations

Read downloading for ibd doest work, need to use their own custom tool.

CAGEF symposium notes:
- GBB has a collaborative internship. wowrk with another lab for 2-4 months during PhD

Things to do:
- Create the effect size figure. show how taxa included in the cluster change, then sum their effect sizes to relate to the cluster.

- Benchmark figures for JP
Ran maaslin on the individual proteins. extract individuals from 3 different clusters. Ideally signficianctly down ones. 
From a large sig down cluster there are 3 distinct proteins that have hits throughout the genomes of many bugs. 
So when we look at the coefs of these three its difficult to say that the there are a lot of species that are driving this change. 
Might need to also look at the species level at the bugs involved in the cluster and how they change. 

06/05/2024

- meeting with JP went well, he made good observations.

- Priorities:
	- process and investigate the IBD data. Look for correlations with our clusters of interest. 
	- Download and investigate the meta-transcriptomics data. 
	- download host exome seq too to look for NOD2 mutants, how does this effect our clusters. 
	- Take a look again at the ICB data. How Does the change in our clusters correlate with response/colitis etc?
	- PCA; should do a PCA on clusters to see disease states they're associated with. 
	- ML, Need to do an ore broad model to use our cluster predictions across trials. 
	- Investigate down clusters more. Need to drop the very small ones likely being driven by a single species shift. Metaphlan profiles necessary

07/05/2024

- ran test kneaddata script on hmp data to see if it is already filtered. 
- check back and run humann once finished.
- Now look into installing metatranscriptomics
- ran download script for mtx, check up on it later
- download script wowrking, downloading to reads dir, need to move after











 
 


















