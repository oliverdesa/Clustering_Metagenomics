Finishing up the break, What I need to do this week

04/01/2024

- Put together and create a small presentation of the protein purification to show dana
- Write down some points of potential next steps
- take inventory of all the trial patients 
	- How many do I have completed?
	- find names of those missing, check if filt reads exist, if not re-download from scratch
- Finish the metadata sheet 
- Test applying the clustering, take notes and important info.
	- How many clusters are being made? How many idividual protein do each of these clusters contain?
- download and run the bariatric data, might have to check how many of the files are potentially missing

05/01/2024

- queued up the remaining reads for kneaddata (Done, Failed)
- clustered PRJEB7774 and applied maaslin
	- 1 significant cluster when doing raw maaslin on relab data
	- ~9 sig clusters when doing CLR maaslin on relab data
	- raw maaslin might be taking into account the actual abundaces better, hard to tell
	- CLR normalization has very low N not 0, looks like a bug with maaslin but not sure. 
- Make a process to look deeper into differentially abundant clusters;
	- what taxa are they mostly coming from?
	- what domains/sec tags do proteins in that cluster typically have? (Running now)
	- visualize the cluster changes between patients
	- make function to easily pull initial proteins collected under a cluster (Done)
	
- Cluster and run Maaslin2 on PRJEB10878
	- Look for repeatedly downregulated clusters

08/02/2024

- Combined and ran DA on Large CRC dataset
- in the pooled, CLR normalized analysis, LD-carboxys are downregulated in early stage patients (p=0.0305281909265825, q=0.24422552741266) (Not that important)
- In analysis, stage 1/2 are characterized as early stage, 3/4 are late stage. HS and MP seperate from healthy, might have to combine those into simply cancer vs no cancer
- signalp and IPS are finished and downloaded to OneDrive, need to make some functions.
	- How do Secreted DLEs change?
	- What are the domains/secretion tags of the clusters? (do it for all to make it easier)

09/01/2024

- Start by building function to grab number of DLE per cluster, domains + secretion tag calculations/cluster make a csv to easily map and build figures
- test out random forest stuff
- issues with cluster mapping, only 1879 of 1960 original proteins seem to be mapping all the way to foldseek clusters. 
- Created function to pull the amount of protiens stored within each cluster
- crreated a function to annotation secretion tags based on uniref ID
- Could technically do DA testing on secreted only DLEs. 
- Should apply DA testing with clustering on PRJEB10878

10/01/2024

- Tried to do DA testing on PRJEB10878 but metadata was lost on old ssd. Metadata download doesnt seem to include patient conditions
- Re-assess clustering function for secretion annotation and protein counts
- SOLVED, some proteins do not have their 3d structured annotated yet so are ignored in the foldseek clustering process. Most are singletons and havent been seen in any of the shotgun data yet. Can submit a job to get those 3d structures predicted for completion sake. 

11/01/2024

- Today, prepare some figures for meeting with Dana and meeting with charlie.
- Make a pooled DA testing figure to compare with the clustered data. (DONE)
- Train some models on the pooled and clustering data then print out some figures. (Move this to later)
- Display some info on cluster secretion tags, domains if possible. 
- make figures of PRJEB7774 and look for common clusters. (Fig made, look for common clusters)
- Plan to make comparisons;
	- pull tables from 8156 and 7774 from heatmap script, pull common clusters that are downregulated. (IPR)
	- use that to look at secretion, % secreted per cluster. (DONE)

13/01/2024

- Notes from meeting with Charlie:
	- find custom database from genomes that map back to uniref IDS. Use those to determine taxanomic composition of clusters.
	- might have multiple mapping back to the same taxa, need to pick one
	- Adjust colour gradient of heatmap so that white is at 0 (done)
	- build a correlation plot between the 2 datasets to see how related they are (Done, weak correlation)
	- look deeper into the formula log(qvalue) * sign(coeff)
	- maybe plot effect size (just coeff?)
	- PCA the clusters from the dataset to see if theyre different
	- Need to prove taxa shifts are not all that explain cluster diffs
- Still need to find PRJEB10878 metadata (Found)
- What clusters are downregulated the most? Of these clusters, which have the highest correlation between the 2 datasets?

15/01/2024

- Ran DA testing on PRJEB10878
	- No significantly down-regulated clusters unfortunately
	- the most common cluster A0A1C5VJV2 Is still heavily downregulated in this dataset
	- This cluster has only 2 members unfortunately, A0A1C5VJV2 and A0A1V6EIC9
	- Bost seem to be coming from clostrideacea family. Should check species from our databases and see what we have.
- Will now start pulling taxa for each uniref ID in our database and add it to the cluster_info.csv.
	- Difficulty finding blastped genomes, wait for charlie
- Will now take a look at GVHD data
	- Really not many samples, probably not worth looking at at this point, wait for large danish dataset
- species question cant be answered until I get the blastp results.
- Should continue with the domain information tomorrow, create the csv
- should also implement code to log and pull secretion information from individual proteins captured, not just cluster members
- relative abundance of each protein also matters in this case, might be a bit complicated.
- Proteins without 3D structure:

17/01/2024

- Clustered all groups of enzymes through msmeqs
- downloaded all PDBs of cluster reps
- ran foldseek to get foldseek clusters
- working on developing a function to create cluster mapping tools
- mapping through DF instead of dict
- important 3D structures may be missing
- Scanning through the cluster maps, quite a few of the mmmseqs representatives are missing AF PDBs. Some ways to address:
	1. Create the PDBs. Set up alphafold on the cluster and feed in un-predicted seqs for prediction. Time consuming, not sure if possible.
	2. Ignore those without PDBs. Those lacking structures are probably rarely known or unimportant protein. Could add checks in the clustering code to 
	   report how many uniref IDs from the humann output table are unnaccounted for after clustering. Potential to miss important proteins.
	3. Could look for predicted proteins clustered to un-predicted rep sequences to replace the representative for that cluster. Might be a slightly poorer
	   representation of all the proteins within that cluster, however would have less gaps, likely would be better than completely ignoring
- Should likely start with 2 and then go from there depending on results. 
- make sure kneaddata + trimmomatic are working, start the bariatric data on graham
	- remember to adjust the kneaddata script for the the 4 in the reads. 

18/01/2024

- started bariatric data and last of CRC data on graham
	- same error with CRC data, the reads are misaligned
- Created an improved large clustering function to look at all of the enzymes within the humann table
- A significant amount of the enzymes are remaining unclustered because the mmseqs reps dont have 3D structures
329 DL-endopeptidase found, 14 DL-endopeptidase unclustered
3935 LD-carboxypeptidase found, 2225 LD-carboxypeptidase unclustered
31 LD-endopeptidase found, 31 LD-endopeptidase unclustered
11481 DD-carboxypeptidase found, 6677 DD-carboxypeptidase unclustered
0 Diadenylate-cyclase found, 0 Diadenylate-cyclase unclustered
- ** amidases, glucosaminidases and muramidases omitted for speed
- email was sent to scinet, hopefully will get a response soon regarding running alphafold
- in the meantime will likely need to move forward with option 3.

22/01/2024

- Scinet responded, beluga and graham are capable of runnning alphafold. Look into setting that up.
- Last of CRC data has error, something went wrong with bariatric. Go back and look.
- addressed errors other than trimmomatic, ran jobs again.
- Need to write a function to check if a Uref ID has a PDB, if print it to a txt to later feed into AF
- Set up Globus, error connecting to clusters, emailed support. 
	- Should try to set up AF asap because it will take ~ a day to install
- Regarding the previous note about the function; What to do:
	- First drop singletons: print out info after
	- Second, create a dataframe without any of the fully clustered protiens
	- Third, loop through and check for PDBs from full Uref100s, if it has one, replace the mmseqs rep w that protein.
	- print out some stats on how many are now unclustered
	- re-run foldseek.
	
23/01/2024

- AF dependancies set up on Beluga, need to figure out downloading the databases, especially with globus if possible (downloading)
- Check on bariatric/CRC data (bariatric good, mismatched reads in CRC)
- subbed humann on bariatric, subbed kneaddata on resequenced reads
- continue with clustering

 
 


















